limit_req_zone $binary_remote_addr zone=iplimit:10m rate=3r/s;
limit_req_zone $binary_remote_addr zone=marketlimit:10m rate=2r/s;

server {
  listen 80;
  ssl on;
  ssl_certificate /etc/nginx/ssl/bundle.crt;
  ssl_certificate_key /etc/nginx/ssl/cryptogametool.key;

  server_name 15.235.146.167;

  location /cgt/apis/elemon/health/transactions {
    if ($request_method = OPTIONS) {
        return 204;
    }

    add_header Access-Control-Allow-Origin "cryptogametool.com";

    limit_req zone=iplimit burst=20;

    proxy_pass http://139.99.238.72:8081/cgt/apis/elemon/health/transactions;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "Upgrade";
  }

  location /cgt/apis/elemon/market {
    if ($request_method = OPTIONS) {
        return 204;
    }

    limit_req zone=marketlimit;

    add_header Access-Control-Allow-Origin "cryptogametool.com";

    proxy_pass http://127.0.0.1:8082/cgt/apis/elemon/market;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "Upgrade";
  }

  location /cgt/apis/elemon/pet/upgrade-cost {
    if ($request_method = OPTIONS) {
        return 204;
    }

    add_header Access-Control-Allow-Origin "cryptogametool.com";

    limit_req zone=marketlimit burst=20;

    proxy_pass http://127.0.0.1:8082/cgt/apis/elemon/pet/upgrade-cost;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "Upgrade";
  }

  location /cgt/apis {
    if ($request_method = OPTIONS) {
        return 204;
    }

    limit_req zone=iplimit burst=20;

    proxy_pass http://127.0.0.1:8081/cgt/apis;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "Upgrade";
  }

  location /apis {
    proxy_pass http://127.0.0.1:8081/apis;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "Upgrade";
  }

  location /_next {
    proxy_pass http://127.0.0.1:3000/_next;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    client_max_body_size 10M;

    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "Upgrade";
  }

  location /assets/images/ {
    alias /home/ubuntu/elemon/crypto-game-tool-app/assets/images/;
  }

  location /sw.js {
    index sw.js;
    alias /home/ubuntu/elemon/crypto-game-tool-app/;
  }

  location /sitemap.xml {
    index sitemap.xml;
    alias /home/ubuntu/elemon/crypto-game-tool-app/;
  }

  location /ads.txt {
    index ads.txt;
    alias /home/ubuntu/elemon/crypto-game-tool-app/;
  }

  location / {
    proxy_pass http://127.0.0.1:3000;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    client_max_body_size 10M;

    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "Upgrade";
  }

}

server {
  listen 443;
  ssl on;
  ssl_certificate /etc/nginx/syssl10/bundle_cert.crt;
  ssl_certificate_key /etc/nginx/syssl10/private.key;

  server_name shineyup.com www.shineyup.com;

  client_max_body_size 10M;

  location /wordpress {
    root /home/ubuntu/shineyup;
    index index.php;

    try_files $uri $uri/ /wordpress/index.php?$args;

    location ~ \.php$ {
      include snippets/fastcgi-php.conf;
      fastcgi_pass unix:/var/run/php/php8.1-fpm.sock;
    }
  }

  location /colosmulti {
    root /home/ubuntu/shineyup;
    index index.php;

    try_files $uri $uri/ /colosmulti/index.php?$args;

    location ~ \.php$ {
      include snippets/fastcgi-php.conf;
      fastcgi_pass unix:/var/run/php/php8.1-fpm.sock;
    }
  }

  location /colormulti {
    root /home/ubuntu/shineyup;
    index index.php;

    try_files $uri $uri/ /newcolos/index.php?$args;

    location ~ \.php$ {
      include snippets/fastcgi-php.conf;
      fastcgi_pass unix:/var/run/php/php8.1-fpm.sock;
    }
  }

  location /newcolos {
    root /home/ubuntu/shineyup;
    index index.php;

    try_files $uri $uri/ /newcolos/index.php?$args;

    location ~ \.php$ {
      include snippets/fastcgi-php.conf;
      fastcgi_pass unix:/var/run/php/php8.1-fpm.sock;
    }
  }


  location /testcolos {
    root /home/ubuntu/shineyup;
    index index.php;

    try_files $uri $uri/ /testcolos/index.php?$args;

    location ~ \.php$ {
      include snippets/fastcgi-php.conf;
      fastcgi_pass unix:/var/run/php/php8.1-fpm.sock;
    }
  }

  location /dayhocnailnoimi {
    root /home/ubuntu/shineyup;
    index index.php;

    try_files $uri $uri/ /dayhocnailnoimi/index.php?$args;

    location ~ \.php$ {
      include snippets/fastcgi-php.conf;
      fastcgi_pass unix:/var/run/php/php8.1-fpm.sock;
    }
  }


  location /midas/internal {
    root /home/ubuntu/shineyup;

    try_files $uri $uri/ /midas/internal/index.html =404;
  }

  location /midas/apis {
    proxy_pass http://127.0.0.1:8082/apis;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "Upgrade";
  }

  location /lianlianglobal {
    root /home/ubuntu/shineyup;
    index index.php;

    try_files $uri $uri/ /lianlianglobal/index.php?$args;

    location ~ \.php$ {
      include snippets/fastcgi-php.conf;
      fastcgi_pass unix:/var/run/php/php8.1-fpm.sock;
    }
  }


  location /.well-known/pki-validation {
    root /home/ubuntu/shineyup;

    try_files $uri /.well-known/pki-validation/058BD38F715D443DDB166C6B41C4027C.txt;
  }

  location /canvas {
    root /home/ubuntu/shineyup;

    try_files $uri /canvas/index.html =404;
  }

  location / {
    proxy_pass http://127.0.0.1:3334;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    client_max_body_size 10M;

    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "Upgrade";
  }

  location /media/ {
    alias /home/ubuntu/shineyup/midas/media/;
    sendfile on;
    sendfile_max_chunk 2m;
  }
}

server {
  listen 80;
  server_name www.shineyup.com;

  return 301 https://www.shineyup.com$request_uri;
}

server {
  listen 80;
  server_name shineyup.com;

  return 301 https://shineyup.com$request_uri;
}

server {
  listen 80;
  server_name beyourprints.com;


  location / {
    root /home/ubuntu/shineyup;

    try_files $uri /canvas/index.html =404;
  }
}

server {
  listen 80;
  server_name www.beyourprints.com;


  location / {
    root /home/ubuntu/shineyup;

    try_files $uri /canvas/index.html =404;
  }
}
